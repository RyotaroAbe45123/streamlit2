import streamlit as st
import pandas as pd

def load_sample_data():
    """ã‚µãƒ³ãƒ—ãƒ«ã®è£œåŠ©é‡‘ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""
    return pd.DataFrame({
        'è£œåŠ©é‡‘å': [
            'ä¸­å°ä¼æ¥­ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–æ”¯æ´è£œåŠ©é‡‘',
            'ä»¤å’Œï¼–å¹´åº¦ ä¸­å°ä¼æ¥­ã®ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ã«ãŠã‘ã‚‹è„±ç‚­ç´ åŒ–ä¿ƒé€²æ”¯æ´äº‹æ¥­åŠ©æˆé‡‘',
            'ä»¤å’Œï¼–å¹´åº¦åƒããƒ‘ãƒ‘ãƒãƒè‚²æ¥­å¿œæ´å¥¨åŠ±é‡‘ã€ã‚‚ã£ã¨ãƒ‘ãƒ‘ã‚³ãƒ¼ã‚¹ã€‘',
            'ä»¤å’Œ6å¹´åº¦ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ä¿ƒé€²åŠ©æˆé‡‘',
            'äº‹æ¥­ç¶™ç¶šæ”¯æ´è£œåŠ©é‡‘'
        ],
        'è£œåŠ©é‡‘é¡ä¸Šé™': [
            '100ä¸‡å††',
            '200ä¸‡å††',
            '300ä¸‡å††',
            '450ä¸‡å††',
            '150ä¸‡å††'
        ],
        'åˆ©ç”¨ç›®çš„': [
            'æ–°è¦äº‹æ¥­',
            'ç ”ç©¶é–‹ç™º',
            'äººæè‚²æˆ',
            'ãƒªãƒ¢ãƒ¼ãƒˆå°å…¥',
            'ãƒªãƒ¢ãƒ¼ãƒˆå°å…¥'
        ],
        'æ¦‚è¦': [
            'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ãƒ¼ãƒ«å°å…¥ã€DXæ¨é€²ã«é–¢ã™ã‚‹è²»ç”¨ã®è£œåŠ©',
            'ã“ã®åŠ©æˆé‡‘ã¯ã€ã€Œä¸­å°ä¼æ¥­ã®ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ã«ãŠã‘ã‚‹è„±ç‚­ç´ åŒ–ä¿ƒé€²æ”¯æ´äº‹æ¥­ã€ã®ãƒãƒ³ã‚ºã‚ªãƒ³æ”¯æ´ã®æ±ºå®šã‚’å—ã‘ã€ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦CO2æ’å‡ºé‡å‰Šæ¸›è¨ˆç”»ã®ç­–å®šã‚’è¡Œã„ã€å…¬ç¤¾ã‹ã‚‰åŒè¨ˆç”»ç­–å®šãŒå®Œäº†ã—ãŸã“ã¨ã‚’èªã‚ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç”³è«‹è¦ä»¶ã§ã™ã€‚',
            'ï¼ˆå…¬è²¡ï¼‰æ±äº¬ã—ã”ã¨è²¡å›£ï¼ˆä»¥ä¸‹ã€Œè²¡å›£ã€ã¨ã„ã†ã€‚ï¼‰ã¯ã€è¤‡æ•°ã®ç”·æ€§å¾“æ¥­å“¡ã«è‚²æ¥­ã•ã›ã‚‹ã¨ã¨ã‚‚ã«ã€ç¶™ç¶šçš„ã«è‚²æ¥­ã—ã‚„ã™ã„è·å ´ç’°å¢ƒã‚’è¤‡æ•°æ•´å‚™ã—ãŸä¼æ¥­ç­‰ã«å¥¨åŠ±é‡‘ã‚’æ”¯çµ¦ã™ã‚‹ã“ã¨ã§ã€ç”·æ€§ã®è‚²å…å‚åŠ ã‚’ä¿ƒé€²ã—ã€è‚²æ¥­ã—ã‚„ã™ã„è·å ´ç’°å¢ƒã®æ”¹å–„ã‚’å›³ã‚Šã¾ã™ã€‚ ',
            'ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ã®ã•ã‚‰ãªã‚‹å®šç€ãƒ»ä¿ƒé€²ã‚’å›³ã‚‹ãŸã‚ã€éƒ½å†…ä¸­å …ã€ä¸­å°ä¼æ¥­ç­‰ã«å¯¾ã—ã€ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ã®å°å…¥ã«å¿…è¦ãªæ©Ÿå™¨ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ç­‰ã®çµŒè²»ã‚’åŠ©æˆã—ã¾ã™ã€‚',
            'äº‹æ¥­ç¶™ç¶šãƒ»å†æ§‹ç¯‰ã«å¿…è¦ãªæŠ•è³‡ã®æ”¯æ´'
        ],
        'ç”³è«‹æœŸé™': [
            '2024å¹´12æœˆ31æ—¥',
            '2024å¹´9æœˆ30æ—¥',
            '2024å¹´10æœˆ31æ—¥',
            '2024å¹´11æœˆ30æ—¥',
            '2024å¹´8æœˆ31æ—¥'
        ],
        'æ¥­ç¨®': [
            'è¾²æ¥­',
            'è£½é€ æ¥­',
            'è¾²æ¥­',
            'ã‚µãƒ¼ãƒ“ã‚¹æ¥­',
            'é‡‘èæ¥­'
        ],
        'å¾“æ¥­å“¡æ•°': [
            'åˆ¶ç´„ãªã—',
            'åˆ¶ç´„ãªã—',
            '5åä»¥ä¸‹',
            '20åä»¥ä¸‹',
            '100åä»¥ä¸‹'
        ],
    })

def search_subsidies(df, keyword='', company_category='', num_of_employee='', company_type=''):
    """è£œåŠ©é‡‘ã‚’æ¤œç´¢ã™ã‚‹é–¢æ•°"""
    if keyword:
        # mask = (
        #     df['è£œåŠ©é‡‘å'].str.contains(keyword, case=False) |
        #     df['æ¦‚è¦'].str.contains(keyword, case=False)
        # )
        mask = (
            df['è£œåŠ©é‡‘å'].str.contains(keyword, case=False)
        )
        df = df[mask]

    if company_category:
        df = df[df['æ¥­ç¨®'].str.contains(company_category, case=False)]
    
    if num_of_employee:
        df = df[df['å¾“æ¥­å“¡æ•°'].str.contains(num_of_employee, case=False)]
    
    if company_type:
        df = df[df['åˆ©ç”¨ç›®çš„'].str.contains(company_type, case=False)]
    
    return df

def main():
    st.title('è£œåŠ©é‡‘æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ')
    
    # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«æ¤œç´¢æ¡ä»¶ã‚’é…ç½®
    st.sidebar.header('æ¤œç´¢æ¡ä»¶')
    
    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
    keyword = st.sidebar.text_input('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢')

    # æ¥­ç¨®
    company_category = ['', 'è¾²æ¥­', 'è£½é€ æ¥­', 'é‡‘èæ¥­', 'ã‚µãƒ¼ãƒ“ã‚¹æ¥­']
    company_category = st.sidebar.selectbox(
        'æ¥­ç¨®',
        company_category
    )

    # å¾“æ¥­å“¡æ•°
    num_of_employees = ['', 'åˆ¶ç´„ãªã—', '5åä»¥ä¸‹', '20åä»¥ä¸‹', '100åä»¥ä¸‹']
    num_of_employee = st.sidebar.selectbox(
        'å¾“æ¥­å“¡æ•°',
        num_of_employees
    )

    # # ä¼æ¥­ç¨®åˆ¥ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿
    # company_types = ['', 'ä¸­å°ä¼æ¥­', 'å°è¦æ¨¡äº‹æ¥­è€…', 'å…¨ä¼æ¥­']
    # company_type = st.sidebar.selectbox(
    #     'å¯¾è±¡ä¼æ¥­ç¨®åˆ¥',
    #     company_types
    # )
    company_types = ['', 'æ–°è¦äº‹æ¥­', 'ç ”ç©¶é–‹ç™º', 'äººæè‚²æˆ', 'ãƒªãƒ¢ãƒ¼ãƒˆå°å…¥']
    company_type = st.sidebar.selectbox(
        'åˆ©ç”¨ç›®çš„',
        company_types
    )
    
    # ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„APIã‹ã‚‰å–å¾—ï¼‰
    df = load_sample_data()
    
    # æ¤œç´¢å®Ÿè¡Œ
    # results = search_subsidies(df, keyword, company_type)
    results = search_subsidies(df, keyword, company_category, num_of_employee, company_type)
    
    # æ¤œç´¢çµæœã®è¡¨ç¤º
    st.subheader('æ¤œç´¢çµæœ')
    if len(results) > 0:
        # å„è£œåŠ©é‡‘ã®è©³ç´°ã‚’è¡¨ç¤º
        for _, row in results.iterrows():
            with st.expander(f"ğŸ“‹ {row['è£œåŠ©é‡‘å']}"):
                st.write(f"**è£œåŠ©é‡‘é¡ä¸Šé™:** {row['è£œåŠ©é‡‘é¡ä¸Šé™']}")
                st.write(f"**åˆ©ç”¨ç›®çš„:** {row['åˆ©ç”¨ç›®çš„']}")
                st.write(f"**æ¦‚è¦:** {row['æ¦‚è¦']}")
                st.write(f"**æ¥­ç¨®:** {row['æ¥­ç¨®']}")
                st.write(f"**å¾“æ¥­å“¡æ•°:** {row['å¾“æ¥­å“¡æ•°']}")
                st.write(f"**ç”³è«‹æœŸé™:** {row['ç”³è«‹æœŸé™']}")
                
                # ä»®ã®ç”³è«‹ãƒœã‚¿ãƒ³
                if st.button('ç”³è«‹ã™ã‚‹', key=row['è£œåŠ©é‡‘å']):
                    st.success('ç”³è«‹ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ï¼ˆãƒ‡ãƒ¢ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰')
    else:
        st.warning('æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è£œåŠ©é‡‘ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚')
    
    # è£œåŠ©é‡‘ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # if st.sidebar.checkbox('è£œåŠ©é‡‘ä¸€è¦§ã‚’è¡¨ç¤º'):
    #     st.subheader('è£œåŠ©é‡‘ä¸€è¦§')
    #     st.dataframe(df)

if __name__ == '__main__':
    main()